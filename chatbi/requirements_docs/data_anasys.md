# 数据分析工作台需求文档

## 1. 项目概述

### 1.1 背景
数据分析工作台是一个用于数据分析师和业务人员进行数据查询、分析和可视化的在线工具。它采用类似Jupyter Notebook的交互方式，允许用户在单元格中输入提示词，获取数据和进行分析，生成报表和图表。

### 1.2 目标
开发一个直观、高效的数据分析平台，帮助用户通过简单的自然语言提示词来完成复杂的数据分析任务，无需编写SQL或代码。平台将支持数据获取、联网检索、趋势分析、对比分析、预测等功能，同时提供变量引用机制，方便用户在不同分析环节引用之前的结果。

## 2. 功能需求

### 2.1 用户界面

#### 2.1.1 工作台布局
- 顶部工具栏：包含"添加单元格"、"运行全部"、"清除输出"等按钮
- 主体区域：按顺序排列的分析单元格
- 响应式设计：适配不同尺寸的屏幕

#### 2.1.2 单元格组件
- 单元格头部：显示单元格类型和操作按钮
- 输入区域：用于输入自然语言提示词的文本框
- 输出区域：显示分析结果、表格和图表
- 单元格底部：显示执行时间和生成的变量

#### 2.1.3 单元格操作
- 复制单元格
- 向上/向下新增单元格
- 上下移动单元格
- 运行单元格
- 删除单元格
- 查看API参数

### 2.2 数据分析功能

#### 2.2.1 支持的分析类型
- **取数**：获取原始数据，以表格形式展示
- **趋势图**：展示时间序列数据的变化趋势
- **柱状图**：用于比较不同类别之间的数值差异
- **统计分析**：计算统计指标，如均值、最大值、最小值等
- **预测分析**：基于历史数据预测未来趋势

#### 2.2.2 通用数据分析参数
样例：
{
    "数据": {
        "表1": {
            "表": [
                "库存联网门店量"
            ],
            "约束": {
                "and": [
                    {
                        "type": "in",
                        "维度": "业绩城市",
                        "枚举值": "广州"
                    },
                    {
                        "type": "in",
                        "维度": "事业部",
                        "枚举值": "广北运营大部"
                    },
                    {
                        "type": "in",
                        "维度": "品牌",
                        "枚举值": "贝联"
                    },
                    {
                        "type": "in",
                        "维度": "大区",
                        "枚举值": "花都西大区"
                    }
                ]
            },
            "时间范围": [
                {
                    "start": "${-1ys_pt}",
                    "end": "${-1ye_pt}"
                }
            ],
            "时间粒度": [
                "月"
            ],
            "组合": [
                "大区"
            ],
            "行数": "5",
            "排序": [
                {
                    "库存联网门店量": "desc"
                }
            ],
            "指标函数": [],
            "错误信息": [],
            "选择": [
                "库存联网门店量"
            ],
            "可视化": "柱状图"
        }
    }
}


### 2.3 变量系统
#### 请求参数
{
    "数据": {
        "表1": {
            "表": [
                "库存联网门店量"
            ],
            "约束": {
                "and": [
                    {
                        "type": "in",
                        "维度": "业绩城市",
                        "枚举值": "广州"
                    },
                    {
                        "type": "in",
                        "维度": "事业部",
                        "枚举值": "广北运营大部"
                    },
                    {
                        "type": "in",
                        "维度": "品牌",
                        "枚举值": "贝联"
                    },
                    {
                        "type": "in",
                        "维度": "大区",
                        "枚举值": "花都西大区"
                    }
                ]
            },
            "时间范围": [
                {
                    "start": "${-1ys_pt}",
                    "end": "${-1ye_pt}"
                }
            ],
            "时间粒度": [
                "月"
            ],
            "组合": [
                "大区"
            ],
            "行数": "5",
            "排序": [
                {
                    "库存联网门店量": "desc"
                }
            ],
            "指标函数": [],
            "错误信息": [],
            "选择": [
                "库存联网门店量"
            ],
            "可视化": "柱状图"
        }
    }
}

#### 2.3.1 请求变量
- 将请求参数按照键值对按钮展示，并且可点击修改

#### 2.3.2 统计变量
- 统计分析结果变量，用于后续分析引用
- 需包括业务指标如"表现最差的业务类型：二手"、"表现最差的大区：西南"等
- 每个变量使用S系列代号（S1-S10+）
- 由于每次分析结果不一定是哪个枚举值，以s1-s10+的方式指代上一步分析的对象



### 2.4 API参数弹窗

#### 2.4.1 标签页结构
- 请求参数：原始API请求参数JSON
- 请求变量：请求参数按照键值对按钮展示，并且可点击修改
- 响应数据：API返回的响应数据JSON
- 统计变量：根据分析结果生成的统计变量键值对代码

#### 2.4.2 功能要求
- 支持参数和响应数据复制
- 提供可视化的变量浏览界面
- 变量可一键复制到剪贴板
- 点击各单元格插入变量的按钮，可以引用上面的单元格生成的变量

## 3. 非功能需求

### 3.1 性能要求
- 页面初始加载时间不超过2秒
- 单元格运行响应时间不超过1秒（模拟）
- 大数据集展示时保持页面流畅

### 3.2 安全要求
- 所有数据在前端处理，不发送到服务器
- 支持本地数据模拟，无需真实后端API

### 3.3 可用性要求
- 直观的用户界面，操作简单明了
- 所有操作提供即时反馈
- 提供复制成功等操作确认提示
- 图表清晰可读，支持交互

## 4. 技术实现

### 4.1 前端技术
- HTML5, CSS3, JavaScript
- echarts用于图表渲染
- 纯前端实现，无需后端支持

### 4.2 数据模拟
- 使用固定的模拟数据集
- 预设的分析结果和图表数据
- 支持不同分析类型的数据预览

### 4.3 响应式设计
- 适配桌面和平板设备
- 图表大小随容器自适应
- 操作按钮在小屏幕上有合理布局

## 5. 用户体验流程

1. 用户打开工作台，看到默认的预设单元格
2. 用户修改单元格中的提示词
3. 点击运行按钮，系统模拟执行并显示结果
4. 用户查看分析结果和生成的图表
5. 用户点击API参数按钮，查看详细的参数和变量
6. 用户可以复制变量，在新的单元格中引用
7. 用户可以添加、删除、移动单元格，构建完整分析流程

## 6. 限制和约束

- 仅支持前端实现，无真实数据请求
- 预设分析类型和数据指标有限
- 不支持自定义图表类型和样式
- 不支持数据导出和共享功能

## 7. 交付物

- 完整的HTML/CSS/JavaScript代码
- 支持上述所有功能的单页面应用
- 预设数据和示例单元格
- 包含所有必要的前端资源

## 8. 开发优先级

1. 基础工作台界面和单元格操作
2. 数据分析功能和图表展示
3. 变量系统和API参数弹窗
4. 请求变量和统计变量完善
5. 响应式布局和用户体验优化

## 9. 项目验收标准

- 所有功能按需求正常工作
- 变量系统完整，包括请求变量和统计变量
- 代码结构清晰，易于维护
- 用户界面直观友好，操作流畅

## 10. 术语表

- **单元格**：工作台的基本组成单位，包含输入和输出区域
- **提示词**：用户输入的自然语言指令
- **请求变量**：表示API请求参数的变量，有字母代号
- **统计变量**：表示分析结果的变量，有S系列代号
- **API参数弹窗**：显示详细请求参数和响应数据的模态窗口