# 数据分析工作台功能说明

## 1. 系统概述

数据分析工作台是一个基于Web的交互式数据分析平台，为用户提供了类似Jupyter Notebook的体验，支持用户通过自然语言提示进行数据分析和可视化操作。主要针对考核收入目标达成率等业务指标进行分析，帮助用户快速理解数据趋势和业务洞察。

## 2. 核心功能

### 2.1 单元格系统

- **单元格创建与管理**：支持添加、删除、复制、上移、下移等操作
- **自然语言输入**：用户可以通过输入自然语言提示词进行数据分析请求
- **文件上传**：支持向单元格中上传附件数据
- **变量引用**：可以引用其他单元格产生的变量，实现多步分析流程

### 2.2 数据分析能力

- **多维数据查询**：支持按城市、大区、品牌等多维度筛选数据
- **时间序列分析**：支持按月、季度等时间粒度进行趋势分析
- **数据统计与计算**：自动计算环比增长、同比增长等指标
- **智能分析与洞察**：自动生成数据分析洞察点和结论

### 2.3 可视化展示

- **多种图表类型**：支持柱状图、折线图、混合图表等可视化方式
- **树状结构图**：用于展示层级关系数据，如业务拆解
- **KPI指标卡片**：突出显示关键业绩指标
- **分析洞察总结**：自动生成文字描述的分析洞察和总结

### 2.4 工具栏功能

- **批量运行**：支持一键运行所有单元格
- **清除输出**：清除所有单元格的输出结果
- **保存功能**：保存当前分析状态
- **导出报告**：支持导出为HTML、PDF、PPT、Word等格式
- **设置参数**：调整分析模板的参数设置

## 3. 技术特点

- **响应式设计**：适配不同屏幕尺寸的设备
- **模块化结构**：通过单元格方式组织分析流程
- **API参数查看**：提供API调用参数和响应数据的查看功能
- **变量系统**：支持统计变量和请求变量的管理与引用

## 4. 典型应用场景

- **目标达成分析**：分析考核收入目标的完成情况及影响因素
- **销售趋势分析**：分析销售额、客流量等指标的变化趋势
- **多维度比较**：对比不同大区、CA间的业绩差异
- **影响因素识别**：识别影响业绩的关键因素，如特定CA或业务线

## 5. 数据模型

系统支持分析的典型数据包括：
- 库存联网门店量
- 销售额
- 客流量
- 考核收入目标完成率
- 大区二手目标完成率
- 西南大区二手目标完成率
- 西南大区CA二手目标完成率

## 6. 使用流程

1. 创建新单元格
2. 输入自然语言提示词描述分析需求
3. 运行单元格获取分析结果
4. 查看数据表格、图表及洞察
5. 根据结果添加新的单元格进行深入分析
6. 导出完整分析报告

## 7. 界面展示

### 7.1 单元格界面说明

单元格是数据分析工作台的基本工作单元，包含以下主要部分：

```
+------------------------------------------------------+
| 单元格 #1                            ⬆️ ⬇️ 🔼 🔽 📋 ▶️ 🔍 🗑️ |
+------------------------------------------------------+
|                                                      |
| [输入自然语言提示词，例如：'显示广州地区贝联品牌的库存联网门店量趋势'] |
|                                                      |
+------------------------------------------------------+
|                                                      |
| [数据表格/图表/分析结果展示区域]                           |
|                                                      |
| +-------------------+  +-------------------+         |
| | KPI指标卡片 1      |  | KPI指标卡片 2      |         |
| +-------------------+  +-------------------+         |
|                                                      |
| [图表展示区域]                                         |
|                                                      |
| 分析洞察：                                            |
| • 洞察点1                                            |
| • 洞察点2                                            |
|                                                      |
| 总结：综合分析结论...                                  |
|                                                      |
+------------------------------------------------------+
| ⏱ 0.8秒  |  S1 S2 S3 S4                              |
+------------------------------------------------------+
```

#### 单元格界面元素说明：

1. **单元格头部**：显示单元格编号及操作按钮（添加、移动、复制、运行、查看API、删除等）
2. **输入区域**：用于输入自然语言提示词
3. **输出区域**：包含多个展示组件
   - KPI指标卡片：显示关键指标值及变化
   - 数据表格：展示详细数据
   - 图表：可视化展示数据趋势
   - 分析洞察：自动生成的数据解读点
   - 总结：整体分析结论
4. **单元格底部**：显示执行时间和可用的统计变量

### 7.2 工具栏说明

工作台顶部的工具栏提供全局操作功能：

```
+------------------------------------------------------+
| 考核收入目标达成率分析 | ➕添加单元格 | ▶️运行全部 | 🧹清除输出 |
| 💾保存 | 📊导出报告 | 🛠️tools | ⚙️设置 | 🔙返回主页  |
+------------------------------------------------------+
```

#### 工具栏功能说明：

- **添加单元格**：在笔记本中创建新的单元格
- **运行全部**：顺序执行所有单元格
- **清除输出**：清除所有单元格的输出结果
- **保存**：保存当前分析状态
- **导出报告**：将分析结果导出为各种格式
- **Tools**：额外工具选项
- **设置**：配置分析模板参数
- **返回主页**：返回系统主页

### 7.3 模态框系统

系统包含多种模态框，用于扩展功能和参数设置：

#### 7.3.1 API参数模态框

点击单元格的"API"按钮可打开API参数模态框，查看当前单元格的API调用细节：

```
+------------------------------------------------------+
| API 参数                                    ×        |
+------------------------------------------------------+
| 请求参数 | 请求变量 | 响应数据 | 统计变量              |
+------------------------------------------------------+
|                                                      |
| {                                                    |
|   "数据": {                                          |
|     "表1": {                                         |
|       "表": ["库存联网门店量"],                        |
|       "约束": {                                       |
|         "and": [                                     |
|           {"type": "in", "维度": "业绩城市", "枚举值": "广州"}, |
|           {"type": "in", "维度": "品牌", "枚举值": "贝联"} |
|         ]                                            |
|       },                                             |
|       "时间范围": [{"start": "${-1ys_pt}", "end": "${-1ye_pt}"}], |
|       "时间粒度": ["月"],                              |
|       "组合": ["大区"],                               |
|       "选择": ["库存联网门店量", "环比增长", "同比增长"]     |
|     }                                                |
|   }                                                  |
| }                                                    |
|                                                      |
+------------------------------------------------------+
| 📋 复制请求参数                                       |
+------------------------------------------------------+
```

此模态框有四个选项卡：
- **请求参数**：显示发送到后端的JSON格式请求内容
- **请求变量**：显示请求中的关键变量
- **响应数据**：显示后端返回的原始数据
- **统计变量**：显示从响应数据中提取的统计变量

#### 7.3.2 变量引用模态框

点击单元格输入区域旁的变量引用按钮可打开此模态框，用于引用其他单元格的变量：

```
+------------------------------------------------------+
| 引用变量                                             |
+------------------------------------------------------+
| 统计变量                                             |
| 单元格 #1 变量                                        |
+------------------------------------------------------+
| S1: 表现最好的月份：2024-12                           |
| S2: 表现最差的月份：2024-01                           |
| S3: 平均库存联网门店量：161家                         |
| S4: 最高月度值：198家 (2024-12)                      |
+------------------------------------------------------+
```

通过点击变量名，可将其插入到当前输入框中，实现跨单元格变量引用。

#### 7.3.3 其他模态框

系统还包含以下模态框：
- **导出报告模态框**：选择导出格式（HTML/PDF/PPT/Word）
- **变量设置模态框**：配置全局变量和参数
- **工具选择模态框**：选择要使用的分析工具

## 8. API参数结构

系统通过标准化的JSON参数结构进行数据查询，典型请求参数包含以下字段：

```json
{
  "数据": {
    "表1": {
      "表": ["库存联网门店量"],
      "约束": {
        "and": [
          {"type": "in", "维度": "业绩城市", "枚举值": "广州"},
          {"type": "in", "维度": "事业部", "枚举值": "广北运营大部"},
          {"type": "in", "维度": "品牌", "枚举值": "贝联"},
          {"type": "in", "维度": "大区", "枚举值": "花都西大区"}
        ]
      },
      "时间范围": [{"start": "${-1ys_pt}", "end": "${-1ye_pt}"}],
      "时间粒度": ["月"],
      "组合": ["大区"],
      "行数": "12",
      "排序": [{"月份": "asc"}],
      "选择": ["库存联网门店量", "环比增长", "同比增长"],
      "可视化": "柱状图"
    }
  }
}
```

### 主要参数说明

- **表**：指定要查询的数据表名称
- **约束**：设置查询的过滤条件，支持and/or逻辑组合
- **时间范围**：指定查询的时间区间，支持动态时间参数
- **时间粒度**：设置时间维度的聚合粒度（日/周/月/季/年）
- **组合**：指定结果的分组维度
- **排序**：设置结果的排序方式
- **选择**：指定需要返回的字段列表
- **可视化**：指定默认的可视化类型 